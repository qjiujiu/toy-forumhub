## 论坛的管理系统

###  产品形态

线上Web/App/小程序

### 接口层

#### 普通用户

- 用户
  - 注册账号：用户输入必填信息即可注册账号
  - 注销账号：用户所有的删除都是软删除

- 发帖
  - 发布帖子：用户必须登录之后才可以发帖，审核通过才算是成功发布
  - 查看帖子：用户可以查看自己发布的所有帖子（除非帖子已被软删除）。对于其他用户发布的帖子，只有在帖子通过审核且状态为“所有用户可见”时，用户才能查看该帖子。
  - 编辑帖子：用户可以编辑发布后的帖子内容，修改帖子发布状态和可见状态
  - 删除帖子：用户所有的删除都是软删除
- 评论
  - 发布评论：用户必须登录之后才可以在帖子下发评论
  - 查看评论：用户可以查看自己发布的所有评论（除非评论已被软删除）。对于帖子下的评论，用户只允许查看审核正常且状态正常的评论。另外，用户不允许搜索评论，也不允许编辑发布之后的评论，避免嫌弃舆论风波
  - 删除评论：用户所有的删除都是软删除
- 点赞
  - 点赞：用户必须登录之后才可以点赞，点赞两种目标类型：帖子与评论；每个用户对一个实体只可以点赞一次，可以软删除点赞之后重新点赞
  - 查看点赞：用户可以自己的所有查看点赞和被点赞记录（除非点赞已被软删除）
  - 取消点赞：用户所有的删除都是软删除
- 关注
  - 关注用户：用户必须登录之后才可以关注其他用户，用户不能关注自己
  - 查看关注：查看关注列表和粉丝列表（互相关注会显示互关标识）
  - 取消关注：用户所有的删除都是软删除

#### 审核员

- 审核
  - 审核帖子：审核员必须登录鉴权之后才可以开始审核帖子，帖子的审核状态一共有3种：待审，通过，拒绝。帖子的默认审核状态是待审。通过和拒绝之间可以随意转换，但是不能切换到待审状态。
  - 审核评论：评论的审核制度采用先发后审：用户评论直接展示，后台异步审核，检测到违规在前端折叠或删除。后续可以采用人工加机器结合的方式审。
  - 查看审核状态：审核员可以查看到所有审核状态的帖子或评论。

#### 管理员

- 查看所有状态的帖子和评论：管理员的权限级别最高，可以查看到任意状态的帖子和评论，是一个数据库管理员。
  - 帖子的发布状态：草稿，发布
  - 帖子的可见状态：所有人可见，仅自己可见
  - 帖子的审核状态：待审，通过，拒绝
  - 评论的审核状态：待审，通过，拒绝
  - 评论的发布状态：折叠，正常
- 软删除：用户不合规的帖子和评论，管理员都可以软删除

- 恢复软删除：所有的软删除实体都可以通过管理员恢复
- 硬删除：只有管理员才有权限硬删除



### 业务层

业务层通过调用数据层的CURD逻辑实现，这里不过多介绍。



### 数据层

#### 用户

- 用户表：用户基本信息（静态信息，多读少改）
- 用户统计数据表：用户关注数，粉丝数（动态信息，多读多改）
- 关注表：用户的关注记录

#### 帖子

- 帖子表：帖子基本信息（静态信息，多读少改）
- 帖子内容表：帖子文本内容（静态信息，多读少改）
- 帖子统计数据表：帖子点赞数，评论数（动态信息，多读多改）

#### 评论

- 评论表：评论基本信息，评论评论数，评论点赞数（动态信息，多读多改）
- 评论内容表：评论文本内容静态信息，多读少改）

#### 点赞

- 点赞表：用户点赞记录

数据表的详细设计可以参考 app/models/数据表设计.md
